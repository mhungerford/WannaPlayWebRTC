<html>
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />
    <link rel="stylesheet" type="text/css" href="base.css" />

    <title>Web4Player</title>
    <style>

    html {
       touch-action: none;
       user-select: none;
       -webkit-user-select: none;
       height: 100%;
       padding-bottom: 1px;
    }

    body {
       margin: 0;
       padding: 0;
       overflow: hidden;
       text-align: center;
       vertical-align: middle;
       height: 100%;
    }

    #make_url {
       position: fixed;
       color: yellow;
       bottom: 10px;
       left: 0;
       width: 100%;
       text-align: center;
       font-weight: bolder;
       font-size: large;
       text-shadow: -2px 0 black, 0 2px black, 1px 0 black, 0 -1px black;
    }

    #option {
        position: relative;
        margin: 6px auto;
	z-index: 100;
    }

    button {
        padding: 6px 16px;
        margin: 0 8px;
    }

    #video {
       position: absolute;
       top: 40%;
       left: 50%;
       transform: translate(-50%, -40%);
       display: none;
       width: 72%;
       height: 72%;
       opacity: 1;
       object-fit: contain;
       filter:
            drop-shadow(0 -4px 0 black)
            drop-shadow(0 4px 0 black)
            drop-shadow(-4px 0 0 black)
            drop-shadow(4px 0 0 black);
    }

    #video2 {
       position: absolute;
       top: 0;
       left: 0;
       width: 100%;
       height: 100%;
       opacity: 1;
       object-fit: cover;
    }

    #camvideo {
       position: absolute;
       top: 50%;
       left: 50%;
       transform: translate(-50%, -50%);
       width: 85%;
       height: 85%;
       opacity: 1;
       object-fit: contain;
    }

    #mjpeg {
       position: absolute;
       top: 0;
       left: 0;
       width: 100%;
       height: 100%;
       opacity: 1;
       object-fit: cover;
    }

    #media {
       position: fixed;
       margin: auto;
       top: 50%;
       left: 0%;
       transform: translate(0%, -50%);
       visibility: visible;
       opacity: 1;
       width: 100%;
       height: 100%;
    }
    </style>
</head>
<!--body onload="loadPad('dpad.css')"-->
<body>
    <script src="touch-emulator.js"></script>
    <script> TouchEmulator(); </script>
    <script type="application/javascript" src="base.js"></script>
    <script>
       // ToggleFullScreen from Mozilla examples
       // developer.mozilla.org/en-US/docs/Web/API/Fullscreen_API
       function toggleFullScreen(fs) {
          var doc = window.document;
          var docEl = doc.documentElement;

          var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
          var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

          if (fs) {
             requestFullScreen.call(docEl);
          } else {
             cancelFullScreen.call(doc);
          }
       }

      window.screen.orientation.addEventListener("change", function () {
            console.log("orentation:" + screen.orientation.type);
            if (screen.orientation.type === "landscape-primary") {
               console.log("going fullscreen");
               toggleFullScreen(true);
            } else if (screen.orientation.type === "portrait-primary") {
               console.log("going windowed");
               toggleFullScreen(false);
            }
      });
   </script>

   <script>
         var document = window.document;
         document.addEventListener('keydown', function(event) {
            // Notice: event.repeat broken on Firefox-X11 (causes more events)
            if (event.repeat || dc == null) { return; }
            switch(event.code) {
               case 'KeyZ':
                  dc.send("keydn: " + 'z');
                  break;
               case 'KeyX':
                  dc.send("keydn: " + 'x');
                  break;
               case 'ArrowLeft':
                  dc.send("keydn: " + 'l');
                  break;
               case 'ArrowRight':
                  dc.send("keydn: " + 'r');
                  break;
               case 'ArrowUp':
                  dc.send("keydn: " + 'u');
                  break;
               case 'ArrowDown':
                  dc.send("keydn: " + 'd');
                  break;
            }
         });
         document.addEventListener('keyup', function(event) {
            if (dc == null) { return; }
            switch(event.code) {
               case 'KeyZ':
                  dc.send("keyup: " + 'z');
                  break;
               case 'KeyX':
                  dc.send("keyup: " + 'x');
                  break;
               case 'ArrowLeft':
                  dc.send("keyup: " + 'l');
                  break;
               case 'ArrowRight':
                  dc.send("keyup: " + 'r');
                  break;
               case 'ArrowUp':
                  dc.send("keyup: " + 'u');
                  break;
               case 'ArrowDown':
                  dc.send("keyup: " + 'd');
                  break;
               case 'Backslash':
                  dc.send("gamectl: " + 'switch');
                  break;
            }
         });
   </script>

<div id="option">
   <!--button id="start" onclick="document.getElementById('mjpeg').src='http://192.168.1.126:8100/?action=snapshot';loadPad('dpad.css');start()">Request Turn</button-->
   <button id="start" onclick="loadPad('dpad.css');start();">Request Turn</button>
   <button id="stop" style="display: none" onclick="stop()">Stop</button>
</div>

<!--
<div id="media">
   <img id="mjpeg" src="http://192.168.1.126:8100/?action=stream" />
</div>
-->

<div>
   <video id="camvideo" autoplay="true" loop muted playsinline="true">
      <source src="prerecorded.mp4"/>
   </video>
</div>

<div>
   <video id="video" autoplay="false" playsinline="true" />
</div>
<!--
<div>
   <video id="video2" autoplay="true" loop muted playsinline="true" src="img/drivetest.mp4" />
</div>
-->
   

<a id="make_url" href="https://makeprojects.com/project/retro-future-remote-play">
   https://makeprojects.com/project/retro-future-remote-play
</a>

<div id="joypad"/>

<script src="client.js"></script>
</body>
</html>
